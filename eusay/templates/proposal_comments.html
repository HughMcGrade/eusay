{% load filters %}

{% for comment in comments %}
<div class="comment row comment_{{ comment.id }}">
    	
  <div class="col-xs-9">
    <p class="authorInfo">
        {% if comment.user.hasProfile%}<a href="/user/{{ comment.user.name }}">{{comment.user.name }}</a>
        {% else %}
        {{ comment.user.name }}
        {% endif %}
        , {{comment.createdAt }}</p>
    <!--<p id="comment_{{ comment.id }}_text">-->{{ comment.text | replace_bad_words | urlize | my_markdown }}<!--</p>-->
  </div>
  <div id="comment_vote_div_{{ comment.id }}" class="col-xs-3 commentVotes">
    {{ comment|comment_user_vote:user }}
  </div>

  {% if comment.get_replies %}

  <a id="replies_{{ comment.id }}_count" class="accordion-toggle" href="#replies_{{ comment.id }}_collapsible" data-toggle="collapse">
    View {{ comment.get_replies|length}} Repl{{ comment.get_replies|pluralize:"y,ies"}}
  </a> |

  {% comment %}
  {% if not comment.replyTo %} |
  {% else %}
  | <a href="/hide_comment/{{ comment.id }}">Hide</a>
  {% else %}
  | <a href="/report_comment/{{ comment.id }}">Report</a>
  {% endif %}
  {% endcomment %}

  {% elif comment.replyTo %}

  {% if user.isModerator %}
  <a href="/hide_comment/{{ comment.id }}">Hide</a>
  {% else %}
  <a href="/report_comment/{{ comment.id }}">Report</a>
  {% endif %}

  {% endif %}

  {% if not comment.replyTo %}

  <a id="reply_to_{{ comment.id }}_count" class="accordion-toggle" href="#reply_to_{{ comment.id }}_collapsible" data-toggle="collapse">Reply</a>
  
  {% if user.isModerator %}
  | <a href="/hide_comment/{{ comment.id }}">Hide</a>
  {% else %}
  | <a href="/report_comment/{{ comment.id }}">Report</a>
  {% endif %}

  {% endif %}
  

  {% if comment.get_replies %}
  <div id="replies_{{ comment.id }}_collapsible" class="accordion-body collapse" style="height: auto; margin-left: 40px;">
    {{ comment | comment_replies:request }}
  </div>
  
  {% endif %}
  
  {% if not comment.replyTo %}
  <div id="reply_to_{{ comment.id }}_collapsible" class="accordion-body collapse" style="height: auto; margin-left: 40px;">
    <form id="reply_to_{{ comment.id }}_form" method="post" action="">
      {% csrf_token %}
      <div class="form-group">
	{{ form.text }}
	<input type="hidden" name="reply_to" id="reply_to" value="{{ comment.id }}" />
      </div>
      <button type="post" class="btn btn-default">Submit</button>
    </form>
  </div>
  {% endif %}

  <hr />
</div>
{% endfor %}
